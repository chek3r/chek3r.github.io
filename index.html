<!DOCTYPE html>
<html>
<head>
    <title>Back Home Program Application Form</title>
    <meta charset="UTF-8">
    <style>
    .backhome-form {
        width: 100%;
        max-width: 600px; /* Optional: Adjust the maximum width */
        margin: 0 auto; /* Optional: Center the form */
    }

    .form-row {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 10px;
    }

    .form-column {
        flex: 1;
        padding-right: 10px; /* Optional: Add some spacing between columns */
    }

    .form-column:last-child {
        padding-right: 0;
    }

    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }

    input[type="text"],
    textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }
    </style>
</head>
<body>
    <div id="formContainer">
        <!-- BBCode будет заменен здесь -->
    </div>

    <script>
        const BBCodeParser = {
            tags: {},

            registerTag: function(tagName, tagDefinition) {
                this.tags[tagName] = tagDefinition;
            },

            parse: function(bbcode) {
                let html = bbcode;

                // Find all tags
                const tagRegex = /\[([a-z]+)(?:=([^\]]+))?](.*?)\[\/\1]/g;
                let match;

                while ((match = tagRegex.exec(bbcode)) !== null) {
                    const tagName = match[1];
                    const tagParams = match[2] ? this.parseParams(match[2]) : {};
                    const tagContent = match[3];
                    const fullTag = match[0];

                    if (this.tags[tagName]) {
                        let openTagHTML = "";
                        let closeTagHTML = "";

                        if (this.tags[tagName].openTag) {
                            openTagHTML = this.tags[tagName].openTag(tagParams, tagContent);
                        }

                        if (this.tags[tagName].closeTag) {
                            closeTagHTML = this.tags[tagName].closeTag(tagParams, tagContent);
                        }

                        const replacementHTML = openTagHTML + tagContent + closeTagHTML;
                        html = html.replace(fullTag, replacementHTML);
                    }
                }

                // Обработка одинарных тегов (без закрывающего тега)
                for (let tagName in this.tags) {
                    if (this.tags[tagName].noClose) {
                        const noCloseTagRegex = new RegExp(`\\[${tagName}(?:=([^\]]+))?\\]`, 'g');
                        while ((match = noCloseTagRegex.exec(html)) !== null) {
                            const tagParams = match[1] ? this.parseParams(match[1]) : {};
                            const fullTag = match[0];

                            if (this.tags[tagName].openTag) {
                                let openTagHTML = this.tags[tagName].openTag(tagParams, '');
                                html = html.replace(fullTag, openTagHTML);
                            }
                        }
                    }
                }

                return html;
            },

            parseParams: function(paramsString) {
                const params = {};
                const keyValuePairs = paramsString.split('&');

                keyValuePairs.forEach(pair => {
                    const [key, value] = pair.split('=');
                    if (key && value) {
                        params[key] = decodeURIComponent(value); // Декодируем URL-кодированные значения
                    }
                });

                return params;
            }
        };

        BBCodeParser.registerTag("backhomeform", {
            openTag: function(params, content) {
                let formHTML = `
                    <div class="backhome-form">
                        <div class="form-row">
                            <div class="form-column">
                                <label for="nickname">1.1 Никнейм персонажа:</label>
                                <input type="text" id="nickname" name="nickname" placeholder="[NICKNAME]">
                            </div>
                            <div class="form-column">
                                <label for="oocname">1.2 ООС никнейм:</label>
                                <input type="text" id="oocname" name="oocname" placeholder="[OOCNAME]">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-column">
                                <label for="fractions">1.3 Фракции в которых вы состояли:</label>
                                <textarea id="fractions" name="fractions" rows="2" placeholder="[FRACTIONS]"></textarea>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-column">
                                <label for="plans">1.4 Планы на будущее персонажа, описание:</label>
                                <textarea id="plans" name="plans" rows="3" placeholder="[PLANS]"></textarea>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-column">
                                <label for="description">Полное описание персонажа:</label>
                                <textarea id="description" name="description" rows="5" placeholder="[DESCRIPTION]"></textarea>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-column">
                                <label for="forumlink">2.1 Ссылка на форумный аккаунт:</label>
                                <input type="text" id="forumlink" name="forumlink" placeholder="[FORUMLINK]">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-column">
                                <label for="vklink">2.2 Ссылка на страницу Вконтакте:</label>
                                <input type="text" id="vklink" name="vklink" placeholder="[VKLINK]">
                            </div>
                            <div class="form-column">
                                <label for="discord">2.3 Логин Discord:</label>
                                <input type="text" id="discord" name="discord" placeholder="[DISCORD]">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-column">
                                <label for="proof">3.1 Доказательства вашей игры (СС, необязательно за копов):</label>
                                <textarea id="proof" name="proof" rows="3" placeholder="[PROOF]"></textarea>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-column">
                                <label for="wishes">3.2 Пожелания:</label>
                                <textarea id="wishes" name="wishes" rows="2" placeholder="[WISHES]"></textarea>
                            </div>
                        </div>

                        <button onclick="generateBBCode(); return false;">Сгенерировать BBCode</button>

                        <textarea id="bbcodeOutput" rows="10" cols="50" readonly></textarea>

                        
                    </div>
                `;
                return formHTML;
            },
            closeTag: function(params, content) {
                return "";
            },
            noClose: true
        });

        // Parse BBCode and insert HTML on page load
        document.addEventListener("DOMContentLoaded", function() {
            const bbcodeText = "[backhomeform]"; // The BBCode to parse
            const htmlOutput = BBCodeParser.parse(bbcodeText); // Parse BBCode
            document.getElementById('formContainer').innerHTML = htmlOutput; // Insert HTML
        });

        function generateBBCode() {
            const nickname = document.getElementById("nickname").value;
            const oocname = document.getElementById("oocname").value;
            const fractions = document.getElementById("fractions").value;
            const plans = document.getElementById("plans").value;
            const description = document.getElementById("description").value;
            const forumlink = document.getElementById("forumlink").value;
            const vklink = document.getElementById("vklink").value;
            const discord = document.getElementById("discord").value;
            const proof = document.getElementById("proof").value;
            const wishes = document.getElementById("wishes").value;

            const bbcode = `
[textarea]
[head]DONALD FLETCHER[/head]


[center][b]BACK HOME PROGRAM APPLICATION[/b][/center]

[hr][/hr]


[b][u]1.1[/u][/b] [ab=НИКНЕЙМ ПЕРСОНАЖА:] ${nickname}\n[/ab]
[b][u]1.2[/u][/b] [ab=ООС НИКНЕЙМ:] ${oocname}\n[/ab]
[b][u]1.3[u][/b] [ab=ФРАКЦИИ В КОТОРЫХ ВЫ СОСТОЯЛИ:] ${fractions}\n[/ab]
[b][u]1.4[/u][/b] [ab=ПЛАНЫ НА БУДУЩЕЕ ПЕРСОНАЖА, ОПИСАНИЕ:] ${plans}\n
[spoiler=ПОЛНОЕ ОПИСАНИЕ]${description}\n[/spoiler]
[/ab]
[b][u]2.1[/u][/b] [ab=ССЫЛКА НА ФОРУМНЫЙ АККАУНТ:] ${forumlink}\n[/ab]
[b][u]2.2[/u][/b] [ab=ССЫЛКА НА СТРАНИЦУ Вконтакте:] ${vklink}\n[/ab]
[b][u]2.3[/u][/b] [ab=ЛОГИН Discord:] ${discord}\n[/ab]
[b][u]3.1[/u][/b] [ab=ДОКАЗАТЕЛЬСТВА ВАШЕЙ ИГРЫ (СС, необязательно за копов):] ${proof}\n[/ab]
[b][u]3.2[/u][/b] [ab=ПОЖЕЛАНИЯ:] ${wishes}[/ab]

Я ознакомлен(-а) с правилами подачи заявления в программу возвращения домой и условиями вступления во фракцию. Я соглашаюсь, что если покину фракцию в течении 14 дней, то буду занесен в черный список (ЧС) фракции без права выхода. Я соглашаюсь, что мое заявление может быть отклонено без объяснения причин. Я понимаю, что в случае слива любой информации с ресурсов фракции я буду занесен в черный список. В случае одобрения, я обязуюсь изучить всю важную информацию фракции (руководства, правила фракции и т.д).
`;

            document.getElementById("bbcodeOutput").value = bbcode;
        }
    </script>
</body>
</html>
